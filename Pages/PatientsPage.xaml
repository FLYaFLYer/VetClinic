<Page x:Class="VetClinic.Pages.PatientsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Пациенты"
      Unloaded="Page_Unloaded">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Верхняя панель с кнопками и поиском -->
        <Border Grid.Row="0" 
                Background="#FFF9F9F9" 
                BorderBrush="#FFEEEEEE" 
                BorderThickness="0,0,0,1"
                Padding="15,10">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="btnAddPatient" 
                        Content="Добавить пациента" 
                        Style="{StaticResource NavButtonStyle}"
                        Height="36"
                        Padding="12,8"
                        Click="BtnAddPatient_Click"/>
                <Button x:Name="btnEditPatient" 
                        Content="Изменить"
                        Style="{StaticResource NavButtonStyle}"
                        Height="36"
                        Padding="12,8"
                        Margin="10,0,0,0"
                        Click="BtnEditPatient_Click"/>
                <Button x:Name="btnDeletePatient" 
                        Content="Удалить"
                        Style="{StaticResource NavButtonStyle}"
                        Height="36"
                        Padding="12,8"
                        Margin="10,0,0,0"
                        Click="BtnDeletePatient_Click"/>
                <Button x:Name="btnViewHistory" 
                        Content="История болезни"
                        Style="{StaticResource NavButtonStyle}"
                        Height="36"
                        Padding="12,8"
                        Margin="10,0,0,0"
                        Click="BtnViewHistory_Click"/>
                <Button x:Name="btnRefresh" 
                        Content="🔄 Обновить"
                        Style="{StaticResource NavButtonStyle}"
                        Height="36"
                        Padding="12,8"
                        Margin="10,0,0,0"
                        Click="BtnRefresh_Click"
                        ToolTip="Обновить данные вручную"/>

                <TextBlock Text="Поиск:" 
                           VerticalAlignment="Center" 
                           Margin="20,0,5,0" 
                           FontWeight="SemiBold" 
                           FontSize="14"/>
                <TextBox x:Name="txtSearch" 
                         Width="200" 
                         Height="36" 
                         VerticalAlignment="Center"
                         Padding="8,4"
                         Style="{StaticResource BaseTextBoxStyle}"
                         ToolTip="Введите кличку для поиска"
                         TextChanged="TxtSearch_TextChanged"/>
            </StackPanel>
        </Border>

        <DataGrid x:Name="dataGrid" 
                  Grid.Row="1" 
                  Margin="15"
                  AutoGenerateColumns="False">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" 
                                    Binding="{Binding Id}" 
                                    Width="50"/>
                <DataGridTextColumn Header="Кличка" 
                                    Binding="{Binding Name}" 
                                    Width="100"/>
                <DataGridTextColumn Header="Вид" 
                                    Binding="{Binding AnimalType.Name}" 
                                    Width="80"/>
                <DataGridTextColumn Header="Порода" 
                                    Binding="{Binding Breed.Name}" 
                                    Width="100"/>
                <DataGridTextColumn Header="Владелец" 
                                    Width="150" 
                                    IsReadOnly="True">
                    <DataGridTextColumn.Binding>
                        <Binding Path="Owner.FullName" Mode="OneWay"/>
                    </DataGridTextColumn.Binding>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Возраст" 
                                    Binding="{Binding AgeFormatted}" 
                                    Width="80" 
                                    IsReadOnly="True"/>
                <DataGridTextColumn Header="Вес" 
                                    Binding="{Binding Weight, StringFormat=N2}" 
                                    Width="60"/>
                <DataGridTextColumn Header="Цвет" 
                                    Binding="{Binding Color}" 
                                    Width="80"/>
                <DataGridTemplateColumn Header="Особые приметы" 
                                        Width="200">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding DistinctiveFeatures}" 
                                           TextWrapping="NoWrap"
                                           MaxWidth="150"
                                           TextTrimming="CharacterEllipsis"
                                           VerticalAlignment="Center"/>
                                <Button Content="👁"
                                        Style="{StaticResource NavButtonStyle}"
                                        Width="30"
                                        Height="24"
                                        Padding="0"
                                        Margin="5,0,0,0"
                                        Tag="{Binding DistinctiveFeatures}"
                                        Click="ViewFeatures_Click"
                                        ToolTip="Просмотр особых примет"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Статусная строка -->
        <Border Grid.Row="2" 
                Background="#FFF9F9F9" 
                BorderBrush="#FFEEEEEE" 
                BorderThickness="0,1,0,0"
                Padding="10,5">
            <TextBlock x:Name="tbStatus" 
                       FontSize="12"
                       Foreground="#666666"/>
        </Border>
    </Grid>
</Page>